<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>seestion</title>
</head>

<body>
  <script>
    (function () {
      const storageKey = "test_client_session_id";

      // Permanent ID 생성 함수
      const generatePermanentId = () => {
        const array = new Uint8Array(16);
        window.crypto.getRandomValues(array);
        return Array.from(array).map(byte => byte.toString(16).padStart(2, '0')).join('');
      };

      // Permanent ID 가져오기
      const getPermanentId = () => {
        if (localStorage.getItem(storageKey)) {
          return localStorage.getItem(storageKey);
        } else {
          // Permanent ID가 없으면 생성하고 로컬 스토리지에 저장
          const newId = generatePermanentId();
          localStorage.setItem(storageKey, newId);
          return newId;
        }
      };

      // postMessage로 부모 창에 데이터 전달
      const permanentId = getPermanentId();
      const data = {
        method: "setPermanentId",
        params: { id: permanentId }
      };

      parent.postMessage(JSON.stringify(data), '*');
    })();
  </script>
</body>

</html>